{% extends "base.html" %}
{% block title %}Login · SPKH{% endblock %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center px-4 py-8">
  <div class="w-full max-w-md rounded-2xl border border-slate-200/80 bg-[var(--card)]/95 shadow-sm px-6 py-6 sm:px-7 sm:py-7">

    <!-- Header -->
    <div class="mb-6">
      <div class="text-[11px] uppercase tracking-wide text-[var(--ink-muted)] mb-1">
        Willkommen zurück
      </div>
      <h1 class="text-xl sm:text-2xl font-semibold text-[var(--ink)]">
        Anmelden
      </h1>
      <p class="mt-1 text-xs text-[var(--ink-muted)]">
        Melde dich mit deinem Konto an, um deine Dokumente zu verwalten.
      </p>
    </div>

    <!-- Fehler -->
    {% if error %}
      <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-3.5 py-2.5 text-xs text-red-700">
        {{ error }}
      </div>
    {% endif %}

    {# Hinweisblock für unverifizierte Accounts #}
    {% if error and ("not verifiziert" in error.lower() or error.strip() == "Account not verified") %}
      <div class="mb-4 rounded-xl border border-amber-200 bg-amber-50 px-3.5 py-3 text-xs text-amber-800 space-y-2">
        <p class="font-medium">
          Dein Konto ist noch nicht bestätigt.
        </p>
        <p>
          Prüfe dein Postfach und den Spam-Ordner. Du kannst dir die Verifizierungs-E-Mail hier erneut senden lassen:
        </p>
        <form method="post" action="/auth/verify/resend" class="flex flex-col sm:flex-row gap-2">
          <input
            type="email"
            name="email"
            value="{{ last_email or '' }}"
            placeholder="E-Mail-Adresse"
            required
            class="flex-1 rounded-lg border border-amber-300 bg-white px-2.5 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-amber-400 focus:border-amber-400"
          >
          <button
            class="inline-flex items-center justify-center rounded-lg border border-amber-400 bg-amber-500/90 px-3 py-1.5 text-xs font-medium text-white hover:bg-amber-500"
          >
            Verifizierungs-E-Mail senden
          </button>
        </form>
      </div>
    {% endif %}

    <!-- Login-Formular -->
    <form method="post" action="/auth/login-web" class="space-y-4">

      <div class="space-y-1.5">
        <label for="identifier" class="block text-xs font-medium text-[var(--ink)]">
          E-Mail oder Benutzername
        </label>
        <input
          id="identifier"
          name="identifier"
          type="text"
          required
          value="{{ last_email or '' }}"
          autocomplete="username"
          class="w-full rounded-lg border border-slate-200 bg-[var(--bg)]/80 px-3 py-2 text-sm text-[var(--ink)]
                 focus:outline-none focus:ring-2 focus:ring-slate-900/70 focus:border-slate-900/70"
        />
      </div>

      <div class="space-y-1.5">
        <div class="flex items-center justify-between">
          <label for="password" class="block text-xs font-medium text-[var(--ink)]">
            Passwort
          </label>
          {% if bad_login %}
            <a href="/auth/password-reset"
               class="text-[11px] font-medium text-sky-600 hover:text-sky-700">
              Passwort vergessen?
            </a>
          {% endif %}
        </div>
        <input
          id="password"
          name="password"
          type="password"
          required
          autocomplete="current-password"
          class="w-full rounded-lg border border-slate-200 bg-[var(--bg)]/80 px-3 py-2 text-sm text-[var(--ink)]
                 focus:outline-none focus:ring-2 focus:ring-slate-900/70 focus:border-slate-900/70"
        />
      </div>

      <div class="flex items-center justify-between pt-1">
        <button
          class="inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow-sm
                 hover:bg-slate-800"
        >
          Login
        </button>
        <div class="flex flex-col items-end text-right">
          <span class="text-[11px] text-[var(--ink-muted)] mb-0.5">
            Noch kein Konto?
          </span>
          <a class="text-xs font-medium text-sky-600 hover:text-sky-700"
             href="/auth/register-web">
            Jetzt registrieren
          </a>
        </div>
      </div>
    </form>

    {% if bad_login and not error %}
      <div class="mt-4 text-[11px] text-center text-[var(--ink-muted)]">
        Probleme beim Anmelden?
        <a class="font-medium text-sky-600 hover:text-sky-700" href="/auth/password-reset">
          Passwort zurücksetzen
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
