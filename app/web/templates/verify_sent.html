<!-- web/templates/verify_sent.html -->
{% extends "base.html" %}
{% block content %}
<div style="max-width:560px;margin:48px auto;padding:24px;border:1px solid #e5e7eb;border-radius:12px;">
  <h1 style="margin:0 0 12px 0;font-size:24px;color:#1f2937;">E-Mail-Verifizierung erforderlich</h1>
  <p>Wir haben eine Verifizierungs-E-Mail an <strong>{{ email }}</strong> gesendet.</p>
  <p>Bitte klicke auf den Link in der E-Mail. Diese Seite aktualisiert sich automatisch, sobald dein Account verifiziert ist.</p>

  <form action="/auth/verify/resend" method="post" style="margin-top:16px;">
    <input type="hidden" name="email" value="{{ email }}">
    <button type="submit"
            style="padding:10px 16px;border:1px solid #d1d5db;border-radius:8px;background:#fff;font-weight:600;cursor:pointer;">
      E-Mail erneut senden
    </button>
  </form>

  <div id="status" style="margin-top:12px;font-size:14px;color:#6b7280;">Warte auf Verifizierung …</div>
</div>

<script>
(function() {
  const email = "{{ email }}";
  const statusEl = document.getElementById("status");

  async function poll() {
    try {
      const res = await fetch(`/auth/verify/status?email=${encodeURIComponent(email)}`, { cache: "no-store" });
      if (res.ok) {
        const data = await res.json();
        if (data.verified === true) {
          statusEl.textContent = "Verifiziert. Weiterleitung …";
          window.location.href = "/auth/login-web?verified=1";
          return;
        }
      }
    } catch (_) { /* ignore */ }
    setTimeout(poll, 5000);
  }

  poll();
})();
</script>
{% endblock %}
