{% extends "base.html" %}

{% block title %}Verifizierungs-E-Mail gesendet · SPKH{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-14 px-4">
  <div class="rounded-2xl border border-blue-200/70 dark:border-blue-500/40 bg-white dark:bg-slate-900/80 shadow-sm px-6 py-5">
    <h1 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
      E-Mail-Verifizierung erforderlich
    </h1>

    <p class="text-sm text-gray-600 dark:text-gray-300">
      Wir haben eine Verifizierungs-E-Mail an
      <span class="font-medium">{{ email }}</span> gesendet.
    </p>
    <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
      Bitte klicke auf den Link in der E-Mail. Dein Account wird dann freigeschaltet.
    </p>

    <form action="/auth/verify/resend" method="post" class="mt-4 flex gap-2">
      <input type="hidden" name="email" value="{{ email }}">
      <button
        type="submit"
        class="inline-flex flex-1 items-center justify-center rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-slate-700"
      >
        E-Mail erneut senden
      </button>
    </form>

    <div id="status" class="mt-3 text-xs text-gray-500 dark:text-gray-400">
      Warte auf Verifizierung …
    </div>
  </div>
</div>

<script>
(function () {
  const email = "{{ email }}";
  const statusEl = document.getElementById("status");

  async function poll() {
    try {
      const res = await fetch(`/auth/verify/status?email=${encodeURIComponent(email)}`, { cache: "no-store" });
      if (res.ok) {
        const data = await res.json();
        if (data.verified === true) {
          statusEl.textContent = "Verifiziert. Weiterleitung …";
          window.location.href = "/auth/login-web?verified=1";
          return;
        }
      }
    } catch (e) {
      // still retry
    }
    setTimeout(poll, 5000);
  }

  poll();
})();
</script>
{% endblock %}
