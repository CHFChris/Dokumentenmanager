<!doctype html>
<html lang="de" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{% block title %}SPKH{% endblock %}</title>

  <!-- Favicon (lege eine Datei ab unter app/web/static/favicon.svg oder .ico) -->
  <link rel="icon" href="{{ url_for('static', path='favicon.svg') }}"/>

  <!-- Theme CSS: WICHTIG über url_for('static', ...) -->
  <link rel="stylesheet" href="{{ url_for('static', path='css/theme.css') }}"/>

  <!-- Tailwind per CDN (für Utility-Klassen in Templates) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Theme schon im <head> setzen (kein FOUC) -->
  <script>
    (function () {
      const KEY = 'dm_theme';
      try {
        const saved = localStorage.getItem(KEY);
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.dataset.theme = theme;
        document.documentElement.classList.toggle('dark', theme === 'dark');
      } catch (e) {
        document.documentElement.dataset.theme = 'light';
        document.documentElement.classList.remove('dark');
      }
    })();
  </script>

  {% block head_extra %}{% endblock %}
</head>
<body class="tw-compat">
  {% set p = request.url.path %}
  {% set current = active if active is defined and active else (
      'dashboard' if p.startswith('/dashboard')
      else 'upload' if p.startswith('/upload')
      else 'documents' if p.startswith('/documents')
      else 'search' if p.startswith('/search')
      else ''
  ) %}

  <!-- Navbar -->
  <header class="nav">
    <div class="navwrap">
      <a href="/dashboard" class="brand flex items-center gap-2">
        <img src="{{ url_for('static', path='img/logo.png') }}" alt="Logo" style="height:24px;width:24px;display:block" />
        SPKH
      </a>

      <div class="spacer"></div>

      {% if user %}
        <nav class="navlinks">
          <a href="/dashboard" class="navlink {{ 'active' if current=='dashboard' else '' }}">Dashboard</a>
          <a href="/upload" class="navlink {{ 'active' if current=='upload' else '' }}">Upload</a>
          <a href="/documents" class="navlink {{ 'active' if current=='documents' else '' }}">Documents</a>
          <a href="/search" class="navlink {{ 'active' if current=='search' else '' }}">Search</a>

          <button id="theme-toggle" class="btn ghost" aria-pressed="false" title="Toggle Theme">🌙</button>

          <form method="post" action="/auth/logout-web">
            <button class="btn">Logout</button>
          </form>
        </nav>
      {% else %}
        <nav class="navlinks">
          <a class="link" href="/auth/login-web">Login</a>
          <a class="link" href="/auth/register-web">Registrieren</a>
        </nav>
      {% endif %}
    </div>
  </header>

  <main class="container">
    {% if error %}
      <div class="alert error">{{ error }}</div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <!-- Theme Toggle -->
  <script>
    (function(){
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      const KEY = 'dm_theme';
      function setTheme(theme){
        document.documentElement.dataset.theme = theme;
        localStorage.setItem(KEY, theme);
        document.documentElement.classList.toggle('dark', theme === 'dark');
        btn.setAttribute('aria-pressed', theme === 'dark');
        btn.textContent = theme === 'dark' ? '☀️' : '🌙';
      }
      btn.addEventListener('click', () => {
        const next = (document.documentElement.dataset.theme === 'dark') ? 'light' : 'dark';
        setTheme(next);
      });
      setTheme(document.documentElement.dataset.theme || 'light');
    })();
  </script>

  {% block body_end %}{% endblock %}
</body>
</html>
