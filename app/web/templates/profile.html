{# app/web/templates/profile.html #}
{% extends "base.html" %}

{% block title %}Profil{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto mt-8 space-y-6">
  <h1 class="text-2xl font-semibold mb-4">Profil verwalten</h1>

  <!-- Basisdaten -->
  <section class="border rounded-lg p-4 bg-white shadow-sm">
    <h2 class="text-lg font-semibold mb-3">Allgemeine Einstellungen</h2>
    <form method="post" action="/profile/update-basic" class="space-y-3">
      <div>
        <label class="block text-sm font-medium mb-1">Name</label>
        <input
          type="text"
          name="name"
          value="{{ user.display_name or '' }}"
          class="w-full border rounded px-3 py-2"
          required
        >
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Sprache</label>
        <select
          name="language"
          class="w-full border rounded px-3 py-2"
        >
          <option value="de" {% if user.language == 'de' %}selected{% endif %}>Deutsch</option>
          <option value="en" {% if user.language == 'en' %}selected{% endif %}>Englisch</option>
        </select>
      </div>
      <div class="pt-2">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Änderungen speichern
        </button>
      </div>
    </form>
  </section>

  <!-- Passwort ändern -->
  <section class="border rounded-lg p-4 bg-white shadow-sm">
    <h2 class="text-lg font-semibold mb-3">Sicherheit / Passwort</h2>

    {# Messagebox bei Fehler #}
    {% if pw_error %}
      <div class="mb-4 rounded-md border border-red-300 bg-red-50 px-3 py-2 text-sm text-red-800 shadow-sm">
        {{ pw_error }}
      </div>
    {% endif %}

    {# Messagebox bei Erfolg #}
    {% if pw_success %}
      <div class="mb-4 rounded-md border border-emerald-300 bg-emerald-50 px-3 py-2 text-sm text-emerald-800 shadow-sm">
        {{ pw_success }}
      </div>
    {% endif %}

    <form method="post" action="/profile/change-password" class="space-y-3">
      <div>
        <label class="block text-sm font-medium mb-1" for="current_password">
          Aktuelles Passwort
        </label>
        <input
          id="current_password"
          name="current_password"
          type="password"
          class="w-full border rounded px-3 py-2"
          required
        />
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm font-medium mb-1" for="new_password">
            Neues Passwort
          </label>
          <input
            id="new_password"
            name="new_password"
            type="password"
            class="w-full border rounded px-3 py-2"
            required
          />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" for="new_password_repeat">
            Neues Passwort (Wiederholung)
          </label>
          <input
            id="new_password_repeat"
            name="new_password_repeat"
            type="password"
            class="w-full border rounded px-3 py-2"
            required
          />
        </div>
      </div>

      <p class="text-xs text-gray-500">
        Hinweis: Zum Ändern wird dein aktuelles Passwort benötigt. Neues Passwort mindestens 8 Zeichen,
        inkl. Zahl und Sonderzeichen (wie bei der Registrierung empfohlen).
      </p>

      <div class="pt-2">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Passwort ändern
        </button>
      </div>
    </form>
  </section>

  <!-- E-Mail ändern -->
  <section class="border rounded-lg p-4 bg-white shadow-sm">
    <h2 class="text-lg font-semibold mb-3">E-Mail-Adresse ändern</h2>
    <form method="post" action="/profile/change-email" class="space-y-3">
      <div>
        <label class="block text-sm font-medium mb-1">Aktuelle E-Mail</label>
        <input
          type="email"
          value="{{ user.email }}"
          class="w-full border rounded px-3 py-2 bg-gray-100"
          disabled
        >
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Neue E-Mail</label>
        <input
          type="email"
          name="new_email"
          class="w-full border rounded px-3 py-2"
          required
        >
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Aktuelles Passwort</label>
        <input
          type="password"
          name="current_password"
          class="w-full border rounded px-3 py-2"
          required
        >
      </div>
      <div class="pt-2">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          E-Mail ändern
        </button>
      </div>
    </form>
  </section>

  <!-- Konto löschen -->
  <section class="border rounded-lg p-4 bg-red-50 border-red-200">
    <h2 class="text-lg font-semibold mb-3 text-red-700">Konto löschen</h2>
    <p class="text-sm text-red-700 mb-3">
      Achtung: Diese Aktion kann nicht rückgängig gemacht werden. Alle Ihre Dokumente und Einstellungen werden entfernt.
    </p>

    {% if delete_error %}
      <div class="mb-3 rounded-md border border-red-400 bg-red-100 px-3 py-2 text-sm text-red-900 shadow-sm">
        {{ delete_error }}
      </div>
    {% endif %}

    {% if delete_success %}
      <div class="mb-3 rounded-md border border-emerald-400 bg-emerald-50 px-3 py-2 text-sm text-emerald-900 shadow-sm">
        {{ delete_success }}
      </div>
    {% endif %}

    <form method="post" action="/profile/delete-account" class="space-y-3">
      <div>
        <label class="block text-sm font-medium mb-1" for="current_password_delete">
          Aktuelles Passwort
        </label>
        <input
          id="current_password_delete"
          name="current_password_delete"
          type="password"
          class="w-full border rounded px-3 py-2"
          required
        />
      </div>

      <div class="flex items-center gap-2">
        <input
          id="confirm_delete"
          name="confirm_delete"
          type="checkbox"
          value="true"
          class="h-4 w-4 rounded border-gray-300"
          required
        />
        <label for="confirm_delete" class="text-sm text-red-800">
          Ja, ich möchte mein Konto endgültig löschen.
        </label>
      </div>

      <div class="pt-2">
        <button
          type="submit"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
        >
          Konto endgültig löschen
        </button>
      </div>
    </form>
  </section>
</div>
{% endblock %}
